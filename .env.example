# =============================================================================
# Budget Automation API - Environment Configuration
# =============================================================================
# Copy this file to .env.local (development) or .env (production)
# NEVER commit .env files to git - they contain secrets!
# 
# Using dotenvx? Great! This file serves as a template.
# Generate secrets with: openssl rand -base64 32
# =============================================================================

# =============================================================================
# NODE.JS & APPLICATION ENVIRONMENT
# =============================================================================

# Application environment mode
# Options: 'production' | 'development' | 'test'
# - production: Enforces strict security (HTTPS, required secrets, minimal logging)
# - development: Relaxed security, detailed logs, auto-generated secrets
NODE_ENV=development

# Port the application listens on
# Default: 3000
PORT=3000

# Trust proxy headers (X-Forwarded-For, X-Forwarded-Proto)
# Set to 'true' if behind a reverse proxy (nginx, CloudFlare, etc.)
# Default: false in development, auto-enabled in production
TRUST_PROXY=false

# =============================================================================
# JWT AUTHENTICATION
# =============================================================================
# CRITICAL: These secrets MUST be unique, random, and at least 32 characters
# Generate with: openssl rand -base64 32
# NEVER use the same secret for different purposes!
# =============================================================================

# Access token signing key
# Used for short-lived API access tokens
# REQUIRED: Server will not start without this in production
# Generate: openssl rand -base64 32
JWT_SECRET=generate_with_openssl_rand_base64_32_CHANGE_ME

# Refresh token signing key
# Used for long-lived refresh tokens (different from JWT_SECRET!)
# REQUIRED: Server will not start without this in production
# Generate: openssl rand -base64 32
JWT_REFRESH_SECRET=generate_with_openssl_rand_base64_32_DIFFERENT_FROM_ABOVE

# Access token time-to-live
# How long access tokens remain valid
# Formats: '1h' (1 hour), '30m' (30 minutes), '3600' (3600 seconds)
# Recommended: 1h for APIs, 15m for high-security applications
# Default: 1h
JWT_ACCESS_TTL=1h

# Refresh token time-to-live
# How long refresh tokens remain valid
# Formats: '24h' (24 hours), '7d' (7 days), '604800' (7 days in seconds)
# Recommended: 7d for web apps, 30d for mobile apps
# Default: 24h
JWT_REFRESH_TTL=24h

# =============================================================================
# SESSION CONFIGURATION
# =============================================================================

# Session encryption secret
# Used for encrypting express-session cookies
# REQUIRED in production, auto-generated in development
# MUST be different from JWT secrets!
# Generate: openssl rand -base64 32
SESSION_SECRET=generate_with_openssl_rand_base64_32_UNIQUE_VALUE

# =============================================================================
# ADMIN USER CONFIGURATION
# =============================================================================

# Default admin username
# Used for initial admin user creation
# Default: admin
ADMIN_USER=admin

# Admin password
# REQUIRED: Must meet complexity requirements:
#   - At least 12 characters
#   - At least one uppercase letter (A-Z)
#   - At least one lowercase letter (a-z)
#   - At least one number (0-9)
#   - At least one special character (!@#$%^&*()_+-=[]{}|;:,.<>?)
# Example: MySecure123!Password
# NEVER commit real passwords to version control!
ADMIN_PASSWORD=Your$ecureP@ssw0rd!

# =============================================================================
# ACTUAL BUDGET INTEGRATION
# =============================================================================

# Actual Budget server URL
# If using docker-compose: http://actual-server:5006
# If using external server: https://your-actual-server.com
# REQUIRED for connecting to Actual Budget
ACTUAL_SERVER_URL=http://actual-server:5006

# Actual Budget server password
# The password you set for your Actual Budget server
# REQUIRED for authentication with Actual Budget
ACTUAL_PASSWORD=your_actual_budget_password

# Actual Budget file/sync ID
# The ID of your budget file (found in Actual Budget settings)
# Format: UUID or custom identifier
# REQUIRED for syncing with the correct budget
ACTUAL_SYNC_ID=My-Finances-1f24ef3

# Data directory for Actual Budget local cache
# Where Actual Budget stores local database files
# Default: /app/.actual-cache
# Ensure this path is writable and backed up
DATA_DIR=/app/.actual-cache

# =============================================================================
# OAUTH2 / n8n INTEGRATION (Optional)
# =============================================================================
# These are OPTIONAL - if not provided, OAuth2 routes will not be mounted
# Only configure if you're integrating with n8n or another OAuth2 client
# =============================================================================

# OAuth2 client ID for n8n
# Identifier for your n8n OAuth2 application
# Optional: Only set if using n8n integration
# N8N_CLIENT_ID=n8n-budget-api

# OAuth2 client secret for n8n
# Secret key for n8n OAuth2 authentication
# CRITICAL: Must be at least 32 characters for security
# Optional: Only set if using n8n integration
# Generate: openssl rand -base64 48
# N8N_CLIENT_SECRET=your_n8n_oauth2_secret_at_least_32_chars

# n8n OAuth2 callback URL
# Where n8n will redirect after authorization
# Format: http://your-n8n-instance:port/rest/oauth2-credential/callback
# Optional: Only set if using n8n integration
# N8N_OAUTH2_CALLBACK_URL=http://localhost:5678/rest/oauth2-credential/callback

# =============================================================================
# CORS CONFIGURATION
# =============================================================================

# Allowed origins for CORS requests
# Comma-separated list of URLs that can make requests to this API
# NO SPACES between entries!
# Examples:
#   Development: http://localhost:3000,http://localhost:5678
#   Production: https://app.example.com,https://admin.example.com
#   Mixed: https://app.example.com,http://localhost:3000
# Default: http://localhost:3000,http://localhost:5678
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5678

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level for application logging
# Options (from most to least verbose):
#   - debug: Everything including detailed debugging info
#   - http: HTTP requests and above
#   - info: General informational messages (recommended for production)
#   - warn: Warnings and errors only
#   - error: Errors only
# Default: info
LOG_LEVEL=info

# =============================================================================
# SECURITY NOTES
# =============================================================================
# 
# REQUIRED IN PRODUCTION:
#   - JWT_SECRET (32+ chars)
#   - JWT_REFRESH_SECRET (32+ chars, different from JWT_SECRET)
#   - SESSION_SECRET (32+ chars, different from JWT secrets)
#   - ADMIN_PASSWORD (12+ chars with complexity requirements)
#   - ACTUAL_SERVER_URL
#   - ACTUAL_PASSWORD
#   - ACTUAL_SYNC_ID
# 
# OPTIONAL BUT RECOMMENDED:
#   - ALLOWED_ORIGINS (whitelist your frontend domains)
#   - LOG_LEVEL (set to 'warn' or 'error' in production for performance)
#   - TRUST_PROXY (true if behind nginx/CloudFlare/load balancer)
# 
# OPTIONAL FOR n8n:
#   - N8N_CLIENT_ID
#   - N8N_CLIENT_SECRET (32+ chars)
#   - N8N_OAUTH2_CALLBACK_URL
# 
# SECURITY CHECKLIST:
#   □ All secrets are unique and randomly generated
#   □ Secrets are at least 32 characters long
#   □ Admin password meets complexity requirements
#   □ NODE_ENV=production in production
#   □ ALLOWED_ORIGINS set to production domains only
#   □ .env file is NOT committed to git (.gitignore includes .env*)
#   □ dotenvx .env.keys file is backed up securely
#   □ All secrets are different from each other
#   □ OAuth2 secret is 32+ chars if using n8n
# 
# QUICK SECRET GENERATION:
#   openssl rand -base64 32   # For all secrets
#   openssl rand -base64 48   # For extra-strong secrets (OAuth2)
#   openssl rand -hex 32      # Alternative format
# 
# =============================================================================

# ==============================================================================
# Security Configuration
# ==============================================================================

# Enable/disable security features
ENABLE_CORS=true
ENABLE_HELMET=true
ENABLE_RATE_LIMITING=true

# Request size limits
MAX_REQUEST_SIZE=10kb

# ==============================================================================
# Production-Only Settings
# ==============================================================================

# Enable HTTPS enforcement (set to 'true' in production)
# FORCE_HTTPS=false

# If behind a reverse proxy (like nginx), trust proxy headers
# TRUST_PROXY=true

# ==============================================================================
# IMPORTANT NOTES
# ==============================================================================

# 1. SECRET GENERATION:
#    For all *_SECRET fields, generate random values with:
#    openssl rand -hex 32      (for 32-char secrets)
#    openssl rand -hex 64      (for 64-char secrets)

# 2. PASSWORD HASHING:
#    To hash the ADMIN_PASSWORD, use:
#    node -e "const bcrypt = require('bcrypt'); bcrypt.hash('password', 12).then(h => console.log(h));"

# 3. PRODUCTION DEPLOYMENT:
#    - Set all *_SECRET values to strong random strings
#    - Set NODE_ENV=production
#    - Use HTTPS (FORCE_HTTPS=true)
#    - Don't rely on defaults
#    - Store .env in secrets manager, NOT in git

# 4. GIT MANAGEMENT:
#    - Add to .gitignore:
#      .env
#      .env.local
#      .env.*.local
#    - Commit .env.example instead with dummy values

# 5. DOCKER DEPLOYMENT:
#    - Do NOT copy .env into Docker image
#    - Pass variables via docker-compose environment or K8s secrets
#    - Mount .env as a volume if necessary

# 6. CI/CD INTEGRATION:
#    - Store secrets in GitHub Secrets
#    - Use GITHUB_TOKEN for built-in access
#    - Never log or print secret values
#    - Rotate secrets quarterly

# ==============================================================================
