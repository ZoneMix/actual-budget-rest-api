openapi: 3.0.0
info:
  title: Actual Budget REST API
  version: 1.0.0
  description: |
    REST API wrapper for Actual Budget with OAuth2 integration for n8n.
    
    **Features:**
    - JWT-based authentication with access and refresh tokens
    - OAuth2 flow for n8n integration
    - Comprehensive metrics collection
    - Health checks with service status
    - Secure ActualQL query endpoint
    - Rate limiting with Redis support
    - Environment variable validation
    - Comprehensive error handling
servers:
  - url: http://localhost:3000
    description: Development server
security:
  - bearerAuth: []
tags:
  - name: Authentication
  - name: OAuth2
  - name: Admin
  - name: Accounts
  - name: Transactions
  - name: Categories
  - name: Category Groups
  - name: Payees
  - name: Budgets
  - name: Rules
  - name: Schedules
  - name: Query
  - name: Health
  - name: Metrics

paths:
  # API v2 endpoints (prefixed with /v2)
  /v2/health:
    $ref: './paths/health.yml#/health'
  /v2/metrics:
    $ref: './paths/metrics.yml#/metrics'
  /v2/metrics/summary:
    $ref: './paths/metrics.yml#/metricsSummary'
  /v2/metrics/reset:
    $ref: './paths/metrics.yml#/metricsReset'
  /v2/auth/login:
    $ref: './paths/authentication.yml#/authLogin'
  /v2/auth/logout:
    $ref: './paths/authentication.yml#/authLogout'
  /v2/accounts:
    $ref: './paths/accounts.yml#/accounts'
  /v2/accounts/{id}:
    $ref: './paths/accounts.yml#/accountById'
  /v2/accounts/{id}/close:
    $ref: './paths/accounts.yml#/accountClose'
  /v2/accounts/{id}/reopen:
    $ref: './paths/accounts.yml#/accountReopen'
  /v2/accounts/{id}/balance:
    $ref: './paths/accounts.yml#/accountBalance'
  /v2/accounts/{accountId}/transactions:
    $ref: './paths/transactions.yml#/accountTransactions'
  /v2/accounts/{accountId}/transactions/import:
    $ref: './paths/transactions.yml#/accountTransactionsImport'
  /v2/transactions/{id}:
    $ref: './paths/transactions.yml#/transactionById'
  /v2/categories:
    $ref: './paths/categories.yml#/categories'
  /v2/categories/{id}:
    $ref: './paths/categories.yml#/categoryById'
  /v2/category-groups:
    $ref: './paths/category-groups.yml#/categoryGroups'
  /v2/category-groups/{id}:
    $ref: './paths/category-groups.yml#/categoryGroupById'
  /v2/payees:
    $ref: './paths/payees.yml#/payees'
  /v2/payees/{id}:
    $ref: './paths/payees.yml#/payeeById'
  /v2/payees/merge:
    $ref: './paths/payees.yml#/payeesMerge'
  /v2/budgets/months:
    $ref: './paths/budgets.yml#/budgetMonths'
  /v2/budgets/{month}:
    $ref: './paths/budgets.yml#/budgetByMonth'
  /v2/budgets/{month}/categories/{categoryId}/budget:
    $ref: './paths/budgets.yml#/budgetCategoryBudget'
  /v2/budgets/{month}/categories/{categoryId}/carryover:
    $ref: './paths/budgets.yml#/budgetCategoryCarryover'
  /v2/budgets/{month}/hold:
    $ref: './paths/budgets.yml#/budgetHold'
  /v2/budgets/{month}/reset-hold:
    $ref: './paths/budgets.yml#/budgetResetHold'
  /v2/rules:
    $ref: './paths/rules.yml#/rules'
  /v2/rules/payees/{payeeId}:
    $ref: './paths/rules.yml#/rulesByPayee'
  /v2/rules/{id}:
    $ref: './paths/rules.yml#/ruleById'
  /v2/schedules:
    $ref: './paths/schedules.yml#/schedules'
  /v2/schedules/{id}:
    $ref: './paths/schedules.yml#/scheduleById'
  /v2/query:
    $ref: './paths/query.yml#/query'
  # Non-versioned endpoints (no /v2 prefix)
  /login:
    $ref: './paths/authentication.yml#/loginForm'
  /oauth/authorize:
    $ref: './paths/oauth2.yml#/oauthAuthorize'
  /oauth/token:
    $ref: './paths/oauth2.yml#/oauthToken'
  /admin:
    $ref: './paths/admin.yml#/adminDashboard'
  /admin/oauth-clients:
    $ref: './paths/admin.yml#/adminOAuthClients'
  /admin/oauth-clients/{clientId}:
    $ref: './paths/admin.yml#/adminOAuthClientById'

components:
  securitySchemes:
    bearerAuth:
      $ref: './components/securitySchemes.yml#/bearerAuth'
  schemas:
    Error:
      $ref: './components/schemas.yml#/Error'
    Success:
      $ref: './components/schemas.yml#/Success'
    Account:
      $ref: './components/schemas.yml#/Account'
    Transaction:
      $ref: './components/schemas.yml#/Transaction'
    Category:
      $ref: './components/schemas.yml#/Category'
    CategoryGroup:
      $ref: './components/schemas.yml#/CategoryGroup'
    Payee:
      $ref: './components/schemas.yml#/Payee'
    Schedule:
      $ref: './components/schemas.yml#/Schedule'
    Rule:
      $ref: './components/schemas.yml#/Rule'
    AuthTokens:
      $ref: './components/schemas.yml#/AuthTokens'
    Balance:
      $ref: './components/schemas.yml#/Balance'
    CreateAccountRequest:
      $ref: './components/schemas.yml#/CreateAccountRequest'
    UpdateAccountRequest:
      $ref: './components/schemas.yml#/UpdateAccountRequest'
    CloseAccountRequest:
      $ref: './components/schemas.yml#/CloseAccountRequest'
    Metrics:
      $ref: './components/schemas.yml#/Metrics'
    MetricsSummary:
      $ref: './components/schemas.yml#/MetricsSummary'
